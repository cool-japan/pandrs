# PandRS パフォーマンスベンチマーク

このドキュメントは、PandRSライブラリのパフォーマンス測定結果をまとめたものです。Rustネイティブ版とPythonバインディング版、およびpandasとの比較を含みます。

## 環境情報

- OS: Linux
- CPU: Intel/AMD x86_64
- メモリ: 8GB以上
- Rust: 1.75.0
- Python: 3.10
- pandas: 2.2.3
- numpy: 2.2.4

## サマリー

|                             | 1万行     | 10万行    | 100万行   |
|-----------------------------|-----------|-----------|-----------|
| pandas                      | 1.9ms     | 19ms      | 216ms     |
| PandRS (Rust ネイティブ)      | 55ms      | 52ms      | 831ms     |
| PandRS (Python バインディング) | 33ms      | 348ms     | 4000ms    |
| **pandas vs Rustネイティブ**  | 28倍速い   | 2.7倍速い  | 3.8倍速い  |
| **Rustネイティブ vs Pythonバインディング** | 1.7倍遅い | 6.7倍速い | 4.8倍速い |

## 詳細結果

### 10万行 DataFrame 作成

```
pandas:                  19ms
PandRS (Rustネイティブ):   52ms
PandRS (Pythonバインディング): 348ms
```

### 100万行 DataFrame 作成

```
pandas:                  216ms
PandRS (Rustネイティブ):   831ms
PandRS (Pythonバインディング): 4000ms
```

## 考察

### 1. pandas vs PandRS (Rustネイティブ)

pandasの方が現状のPandRS Rustネイティブ実装よりも高速です。これは以下の理由によるものと考えられます：

- pandasはC言語で書かれた高度に最適化された実装で、長年の最適化によりパフォーマンスが向上しています
- NumPyの高速なバックエンドを使用し、メモリレイアウトやキャッシュ効率が非常に良い設計です
- データ型に特化した最適化（整数/浮動小数点数用の特殊パス）を持っています
- 行数が増えても比較的リニアなスケーリングを示します

### 2. Rustネイティブ vs Pythonバインディング

PandRSのRustネイティブ実装とPythonバインディング実装の間には大きなパフォーマンス差があります：

- 小規模データ（1万行以下）では差は小さいですが、データサイズが大きくなるにつれ差が拡大します
- 100万行データでは、Rustネイティブ実装がPythonバインディング版よりも約4.8倍高速です
- この差はPython-Rust間のデータ変換オーバーヘッドが主な原因です
- 特に文字列データの変換が高コストです

### 3. 改善の余地

PandRSのパフォーマンス向上のために検討できる事項：

#### Rustネイティブの改善点：

1. **データ構造の最適化**
   - 列指向の効率的なストレージ実装
   - メモリレイアウトの改善（キャッシュ効率向上）
   - データ型に特化した最適化パス

2. **アルゴリズムの最適化**
   - 不要なコピーや変換の削減
   - SIMD命令の活用
   - より効率的なメモリ管理

#### Pythonバインディングの改善点：

1. **データ変換オーバーヘッドの削減**
   - NumPyバッファプロトコルの活用
   - ゼロコピーの実現
   - ネイティブ型の直接サポート

2. **メモリ共有**
   - Python-Rust間でのメモリ共有メカニズムの実装
   - 不要な変換の回避

## 将来の展望

PandRSは開発初期段階であり、継続的な最適化によりパフォーマンスが向上する余地が大きいです。特に以下の点に注力することで、pandasに匹敵する、あるいは上回るパフォーマンスが期待できます：

1. より効率的なメモリ使用と管理
2. 並列処理の活用（Rayon等）
3. データ型特化の最適化
4. PyO3バインディングの最適化

## 実行方法

Rustネイティブベンチマークの実行：

```bash
cargo run --release --example performance_bench
cargo run --release --example benchmark_million
```

Pythonバインディングベンチマークの実行：

```bash
python -m pandrs.benchmark
python examples/benchmark_million.py
```